TIPO_CARACT_RES)
}else{
TIPO_CARACT_RES <- as.numeric(as.character(row$TIPO_CARACT_RES1)):as.numeric(as.character(row$TIPO_CARACT_RES2))
row_1 <- cbind(row, TIPO_CARACT_RES) %>%
as.data.frame() %>%
dplyr::select(tabla, EC_MO_ID, CODIGO_USO1, CODIGO_USO2,
EDAD_PREDIO1, PUNTAJE1, AREA_USO1,
AREA_USO2, VAL_METRO_CUAD, AREA_USO,
TIPO_CARACT_RES)
}
return(row_1)
}
df_join %>%
filter(tabla == "T02-2") %>% t() %>%
map(~marca_manzana_row(.x))
df_join %>%
filter(tabla == "T02-2") %>% t() %>%
as.data.frame() %>%
map(~marca_manzana_row(.x))
t <- df_join %>%
filter(tabla == "T02-2") %>% t()
t2 <- t[,1] %>% as.data.frame
marca_manzana_row(t2)
t2 <- t[,2] %>% as.data.frame
marca_manzana_row(t2)
df_join %>%
filter(tabla == "T02-2") %>% t()
df_join %>%
filter(tabla == "T02-2") %>% t() %>%
as.data.frame()
df_join %>%
filter(tabla == "T02-2") %>%
slice(1) %>%
t() %>%
as.data.frame()
df_join %>%
filter(tabla == "T02-2") %>%
slice(1) %>%
t() %>%
as.data.frame() %>%
map(~marca_manzana_row(.x))
marca_manzana_row(t)
t
df_join %>%
filter(tabla == "T02-2") %>%
slice(1)
df_join %>%
filter(tabla == "T02-2") %>%
slice(1) %>%
t()
df_join %>%
filter(tabla == "T02-2") %>%
slice(1) %>%
t() %>%
as.data.frame()
t <- df_join %>%
filter(tabla == "T02-2") %>%
slice(1) %>%
t() %>%
as.data.frame()
t
marca_manzana_row(t)
t <- df_join %>%
filter(tabla == "T02-2") %>%
slice(1:10) %>%
t() %>%
as.data.frame()
map(t, ~marca_manzana_row(.x))
t
Tabla_sas <- NULL
Tabla_sas <- NULL
for(k in 1:3){
if(k == 1){
Tabla_sas <- marca_manzana_row(df_join[k, ])
}else{
Tabla_sas <- Tabla_sas %>% rbind(marca_manzana_row(df_join[k, ])) %>% as.data.frame()
}
}
df_join
k
marca_manzana_row <- function(row){
#row <- t2
#row <- t(row) %>% as.data.frame()
if((row$TIPO_CARACT_RES1 == row$TIPO_CARACT_RES2) &
(row$TIPO_CARACT_RES2 == 8 & row$TIPO_CARACT_RES1 %in% c(0, 1))){
row_1 <- row  %>% mutate(TIPO_CARACT_RES = NA) %>%
dplyr::select(tabla, EC_MO_ID, CODIGO_USO1, CODIGO_USO2,
EDAD_PREDIO1, PUNTAJE1, AREA_USO1,
AREA_USO2, VAL_METRO_CUAD, AREA_USO,
TIPO_CARACT_RES)
}else if((row$TIPO_CARACT_RES1 == row$TIPO_CARACT_RES2) &
(row$TIPO_CARACT_RES2 != 8 | !(row$TIPO_CARACT_RES1 %in% c(0,1)))){
row_1 <- row  %>% mutate(TIPO_CARACT_RES = TIPO_CARACT_RES1) %>%
dplyr::select(tabla, EC_MO_ID, CODIGO_USO1, CODIGO_USO2,
EDAD_PREDIO1, PUNTAJE1, AREA_USO1,
AREA_USO2, VAL_METRO_CUAD, AREA_USO,
TIPO_CARACT_RES)
}else if((as.numeric(as.character(row$TIPO_CARACT_RES2)) == (as.numeric(as.character(row$TIPO_CARACT_RES1)) + 1)) &
(row$TIPO_CARACT_RES2 != 8 | row$TIPO_CARACT_RES1 != 0)){
row_1 <- row %>%
pivot_longer(names_to = "TIPO_CARACT_PREVIA", values_to = "TIPO_CARACT_RES", cols = c("TIPO_CARACT_RES1", "TIPO_CARACT_RES2")) %>%
as.data.frame() %>%
dplyr::select(tabla, EC_MO_ID, CODIGO_USO1, CODIGO_USO2,
EDAD_PREDIO1, PUNTAJE1, AREA_USO1,
AREA_USO2, VAL_METRO_CUAD, AREA_USO,
TIPO_CARACT_RES)
}else{
TIPO_CARACT_RES <- as.numeric(as.character(row$TIPO_CARACT_RES1)):as.numeric(as.character(row$TIPO_CARACT_RES2))
row_1 <- cbind(row, TIPO_CARACT_RES) %>%
as.data.frame() %>%
dplyr::select(tabla, EC_MO_ID, CODIGO_USO1, CODIGO_USO2,
EDAD_PREDIO1, PUNTAJE1, AREA_USO1,
AREA_USO2, VAL_METRO_CUAD, AREA_USO,
TIPO_CARACT_RES)
}
return(row_1)
}
for(k in 1:3){
if(k == 1){
Tabla_sas <- marca_manzana_row(df_join[k, ])
}else{
Tabla_sas <- Tabla_sas %>% rbind(marca_manzana_row(df_join[k, ])) %>% as.data.frame()
}
}
Tabla_sas
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022) %>% as.data.table()
excel_name <- "input/T01-Residencial todos los rangos Vigencia 2022_ajustado8_entrega 21092021.xlsx"
nombre_export <- "_REPORTE_SIE_VR_UNITARIO_TABLAS_NPH"
nombre_export_est <- "_ARCHIVO_CARGUE_VR_UNIT_ESTADISTICA"
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-1", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-5", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-6", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-7", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-8", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
#
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-1", tabla_correlativa = tabla_correlativa)  %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T04.xlsx", tabla_selected = "T04", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-1", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
#
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "0", AREA_USO2 = "350", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "350,01", AREA_USO2 = "1000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "1000,01", AREA_USO2 = "6000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "6000,01", AREA_USO2 = "1000000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "350", AREA_USO2 = "500", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "500,01", AREA_USO2 = "750", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "750,01", AREA_USO2 = "2000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "2000,01", AREA_USO2 = "5000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# #make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "5000,01", AREA_USO2 = "10000")
#
#
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "0", AREA_USO2 = "350", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "350,01", AREA_USO2 = "1000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "1000,01", AREA_USO2 = "6000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
df_completo <- pmap_dfr(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3), rep("input/T07.xlsx", 3)),
c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3), rep("T07", 3)),
c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01", "0", "100,01", "350,01"),
c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000", "100", "350", "100000")),
~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
# df_separados <- pmap(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3)),
#                              c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3)),
#                              c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01"),
#                              c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000")),
#                         ~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
df_join <- df_completo %>%
mutate(TIPO_CARACT = case_when(TIPO_CARACT_RES1 != 0 | TIPO_CARACT_RES2 != 8 ~ paste0(TIPO_CARACT_RES1, "-",TIPO_CARACT_RES2),
TRUE ~ "0"),
AREA_USO = case_when(AREA_USO1 != 0 | AREA_USO2 != 1000000 ~ paste0(AREA_USO1, "-", AREA_USO2),
TRUE ~ "0")) %>%
dplyr::select(c("EC_MO_ID",
"CODIGO_USO1",
"CODIGO_USO2",
"TIPO_CARACT_RES1",
"TIPO_CARACT_RES2",
"EDAD_PREDIO1",
"PUNTAJE1",
"AREA_USO1",
"AREA_USO2",
"VAL_METRO_CUAD",
"TIPO_CARACT",
"AREA_USO")) %>%
left_join(tabla_correlativa[, c("codigo_produccion", "tabla")], by = c("EC_MO_ID" = "codigo_produccion"))
wb <- createWorkbook("Camilo Avellaneda")
addWorksheet(wb, "Consolidado")
writeData(wb, "Consolidado", df_completo)
saveWorkbook(wb, paste0("output/", str_replace_all(Sys.Date(), c("-" = "", "2021" = "21")),
nombre_export, ".xlsx"), overwrite = T)
Tabla_sas_1 <- NULL
Tabla_sas_2 <- NULL
for(k in 1:nrow(df_join)){
if(k == 1){
Tabla_sas_1 <- marca_manzana_row(df_join[k, ])
}else{
Tabla_sas_1 <- Tabla_sas_1 %>% rbind(marca_manzana_row(df_join[k, ])) %>% as.data.frame()
}
}
for(m in 1:nrow(Tabla_sas_1)){
if(m == 1){
Tabla_sas_2 <- uso_row(Tabla_sas_1[k, ])
}else{
Tabla_sas_2 <- Tabla_sas_2 %>% rbind(uso_row(Tabla_sas_1[k, ])) %>% as.data.frame()
}
}
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022) %>% as.data.table()
excel_name <- "input/T01-Residencial todos los rangos Vigencia 2022_ajustado8_entrega 21092021.xlsx"
nombre_export <- "_REPORTE_SIE_VR_UNITARIO_TABLAS_NPH"
nombre_export_est <- "_ARCHIVO_CARGUE_VR_UNIT_ESTADISTICA"
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-1", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-5", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-6", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-7", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-8", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
#
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-1", tabla_correlativa = tabla_correlativa)  %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T04.xlsx", tabla_selected = "T04", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-1", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
#
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "0", AREA_USO2 = "350", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "350,01", AREA_USO2 = "1000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "1000,01", AREA_USO2 = "6000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "6000,01", AREA_USO2 = "1000000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "350", AREA_USO2 = "500", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "500,01", AREA_USO2 = "750", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "750,01", AREA_USO2 = "2000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "2000,01", AREA_USO2 = "5000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# #make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "5000,01", AREA_USO2 = "10000")
#
#
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "0", AREA_USO2 = "350", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "350,01", AREA_USO2 = "1000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "1000,01", AREA_USO2 = "6000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
df_completo <- pmap_dfr(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3), rep("input/T07.xlsx", 3)),
c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3), rep("T07", 3)),
c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01", "0", "100,01", "350,01"),
c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000", "100", "350", "100000")),
~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
# df_separados <- pmap(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3)),
#                              c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3)),
#                              c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01"),
#                              c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000")),
#                         ~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
df_join <- df_completo %>%
mutate(TIPO_CARACT = case_when(TIPO_CARACT_RES1 != 0 | TIPO_CARACT_RES2 != 8 ~ paste0(TIPO_CARACT_RES1, "-",TIPO_CARACT_RES2),
TRUE ~ "0"),
AREA_USO = case_when(AREA_USO1 != 0 | AREA_USO2 != 1000000 ~ paste0(AREA_USO1, "-", AREA_USO2),
TRUE ~ "0")) %>%
dplyr::select(c("EC_MO_ID",
"CODIGO_USO1",
"CODIGO_USO2",
"TIPO_CARACT_RES1",
"TIPO_CARACT_RES2",
"EDAD_PREDIO1",
"PUNTAJE1",
"AREA_USO1",
"AREA_USO2",
"VAL_METRO_CUAD",
"TIPO_CARACT",
"AREA_USO")) %>%
left_join(tabla_correlativa[, c("codigo_produccion", "tabla")], by = c("EC_MO_ID" = "codigo_produccion"))
wb <- createWorkbook("Camilo Avellaneda")
addWorksheet(wb, "Consolidado")
writeData(wb, "Consolidado", df_completo)
saveWorkbook(wb, paste0("output/", str_replace_all(Sys.Date(), c("-" = "", "2021" = "21")),
nombre_export, ".xlsx"), overwrite = T)
wb <- createWorkbook("Camilo Avellaneda")
addWorksheet(wb, "Consolidado")
writeData(wb, "Consolidado", df_completo)
saveWorkbook(wb, paste0("output/", str_replace_all(Sys.Date(), c("-" = "", "2021" = "21")),
nombre_export, ".xlsx"), overwrite = T)
Tabla_sas_1 <- NULL
Tabla_sas_2 <- NULL
for(k in 1:nrow(df_join)){
if(k == 1){
Tabla_sas_1 <- marca_manzana_row(df_join[k, ])
}else{
Tabla_sas_1 <- Tabla_sas_1 %>% rbind(marca_manzana_row(df_join[k, ])) %>% as.data.frame()
}
}
2+2
df_completo <- df_completo %>% mutate(AREA_TERRENO1 == case_when(EC_MO_ID == 389 ~ "49",
TRUE ~ AREA_TERRENO1),
AREA_TERRENO1 == case_when(EC_MO_ID == 389 ~ "100000000",
TRUE ~ AREA_TERRENO2))
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022) %>% as.data.table()
excel_name <- "input/T01-Residencial todos los rangos Vigencia 2022_ajustado8_entrega 21092021.xlsx"
nombre_export <- "_REPORTE_SIE_VR_UNITARIO_TABLAS_NPH"
nombre_export_est <- "_ARCHIVO_CARGUE_VR_UNIT_ESTADISTICA"
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-1", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-5", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-6", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-7", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T01.xlsx", tabla_selected = "T01-8", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
#
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-1", tabla_correlativa = tabla_correlativa)  %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T02.xlsx", tabla_selected = "T02-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T04.xlsx", tabla_selected = "T04", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-1", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-2", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-3", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T05.xlsx", tabla_selected = "T05-4", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
#
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "0", AREA_USO2 = "350", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "350,01", AREA_USO2 = "1000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "1000,01", AREA_USO2 = "6000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T03.xlsx", tabla_selected = "T03", AREA_USO1 = "6000,01", AREA_USO2 = "1000000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
#
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "350", AREA_USO2 = "500", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "500,01", AREA_USO2 = "750", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "750,01", AREA_USO2 = "2000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "2000,01", AREA_USO2 = "5000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# #make_txt_file(excel_name = "input/T06.xlsx", tabla_selected = "T06", AREA_USO1 = "5000,01", AREA_USO2 = "10000")
#
#
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "0", AREA_USO2 = "350", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "350,01", AREA_USO2 = "1000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
# make_txt_file(excel_name = "input/T19.xlsx", tabla_selected = "T19", AREA_USO1 = "1000,01", AREA_USO2 = "6000", tabla_correlativa = tabla_correlativa) %>% validate_values_tables(., tabla_correlativa)
df_completo <- pmap_dfr(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3), rep("input/T07.xlsx", 3)),
c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3), rep("T07", 3)),
c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01", "0", "100,01", "350,01"),
c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000", "100", "350", "100000")),
~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
df_completo <- df_completo %>% mutate(AREA_TERRENO1 == case_when(EC_MO_ID == 389 ~ "49",
TRUE ~ AREA_TERRENO1),
AREA_TERRENO1 == case_when(EC_MO_ID == 389 ~ "100000000",
TRUE ~ AREA_TERRENO2))
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022) %>% as.data.table()
excel_name <- "input/T01-Residencial todos los rangos Vigencia 2022_ajustado8_entrega 21092021.xlsx"
nombre_export <- "_REPORTE_SIE_VR_UNITARIO_TABLAS_NPH"
nombre_export_est <- "_ARCHIVO_CARGUE_VR_UNIT_ESTADISTICA"
df_completo <- pmap_dfr(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3), rep("input/T07.xlsx", 3)),
c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3), rep("T07", 3)),
c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01", "0", "100,01", "350,01"),
c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000", "100", "350", "100000")),
~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022) %>% as.data.table()
excel_name <- "input/T01-Residencial todos los rangos Vigencia 2022_ajustado8_entrega 21092021.xlsx"
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022) %>% as.data.table()
tabla_correlativa %>% lazy_dt()
tabla_correlativa %>% lazy_dt()
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa
tabla_correlativa %>% lazy_dt()
tabla_correlativa <- tabla_correlativa %>%
filter(codigo_produccion != 2022) %>% as.data.table()
tabla_correlativa
tabla_correlativa$codigo_produccion
tabla_correlativa <- tabla_correlativa %>% filter(codigo_produccion != 2022)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% filter(codigo_produccion != 2022) %>%
as.data.table()
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% filter(codigo_produccion != 2022)
tabla_correlativa <- tabla_correlativa %>% filter(codigo_produccion != 2022)
excel_name <- "input/T01-Residencial todos los rangos Vigencia 2022_ajustado8_entrega 21092021.xlsx"
nombre_export <- "_REPORTE_SIE_VR_UNITARIO_TABLAS_NPH"
nombre_export_est <- "_ARCHIVO_CARGUE_VR_UNIT_ESTADISTICA"
df_completo <- pmap_dfr(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3), rep("input/T07.xlsx", 3)),
c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3), rep("T07", 3)),
c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01", "0", "100,01", "350,01"),
c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000", "100", "350", "100000")),
~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
df_completo <- df_completo %>% mutate(AREA_TERRENO1 == case_when(EC_MO_ID == 389 ~ "49",
TRUE ~ AREA_TERRENO1),
AREA_TERRENO1 == case_when(EC_MO_ID == 389 ~ "100000000",
TRUE ~ AREA_TERRENO2))
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa <- tabla_correlativa %>% filter(codigo_produccion != 2022)
excel_name <- "input/T01-Residencial todos los rangos Vigencia 2022_ajustado8_entrega 21092021.xlsx"
nombre_export <- "_REPORTE_SIE_VR_UNITARIO_TABLAS_NPH"
nombre_export_est <- "_ARCHIVO_CARGUE_VR_UNIT_ESTADISTICA"
tabla_correlativa
tabla_correlativa
tabla_correlativa
tabla_correlativa
tabla_correlativa
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names() %>% as.data.table()
tabla_correlativa
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names()
tabla_correlativa <- tabla_correlativa %>% filter(codigo_produccion != 2022)
tabla_correlativa
df_completo <- pmap_dfr(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3), rep("input/T07.xlsx", 3)),
c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3), rep("T07", 3)),
c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01", "0", "100,01", "350,01"),
c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000", "100", "350", "100000")),
~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
tabla_correlativa
tabla_correlativa$tabla
tabla_correlativa
df_completo <- pmap_dfr(list(c(rep("input/T01.xlsx", 8), rep("input/T02.xlsx", 4), "input/T04.xlsx", rep("input/T05.xlsx", 4), rep("input/T03.xlsx", 4), rep("input/T06.xlsx", 4), rep("input/T19.xlsx", 3), rep("input/T07.xlsx", 3)),
c(paste0("T01-", 1:8), paste0("T02-", 1:4), "T04", paste0("T05-", 1:4), rep("T03", 4), rep("T06", 4), rep("T19", 3), rep("T07", 3)),
c(rep(NA, 17), "0", "350,01", "1000,01", "6000,01", "350", "500,01", "750,01", "2000,01", "0", "350,01", "1000,01", "0", "100,01", "350,01"),
c(rep(NA, 17), "350", "1000", "6000", "1000000", "500", "750", "2000", "5000", "350", "1000", "6000", "100", "350", "100000")),
~make_txt_file(excel_name = ..1, tabla_selected = ..2, AREA_USO1 = ..3, AREA_USO2 = ..4, tabla_correlativa = tabla_correlativa))
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022)
tabla_correlativa
rm(list = ls())
require(pacman)
p_load(tidyverse, openxlsx, janitor, data.table, dtplyr)
source("src/Funciones.R")
options(scipen = 999)
tabla_correlativa <- read.xlsx("input/CARGUE TABLAS VIG 2022.xlsx", "TABLAS NPH") %>%
clean_names()
tabla_correlativa <- tabla_correlativa %>% lazy_dt() %>%
filter(codigo_produccion != 2022)
tabla_correlativa
